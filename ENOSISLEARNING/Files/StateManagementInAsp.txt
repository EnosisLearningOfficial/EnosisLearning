State Management

1.Client-Side State Management
(a) ViewState
 <asp:TextBox ID="txtName" runat="server" />
 <asp:Button ID="btnSave" runat="server" OnClick="btnSave_Click" Text="Save"/>
 <asp:Label ID="lblResult" runat="server" />

protected void btnSave_Click(object sender, EventArgs e)
{
    ViewState["UserName"] = txtName.Text;
    lblResult.Text = "Saved in ViewState"+ ViewState["UserName"].ToString();
}

(b) HiddenField

 <asp:HiddenField ID="Hidden1" runat="server"/>
  <asp:Button ID="btnSet" runat="server" Text="Set" OnClick="btnSet_Click" />
  <asp:Button ID="btnGet" runat="server" Text="Get" OnClick="btnGet_Click" />
  <asp:Label ID="lblResult" runat="server"></asp:Label>

protected void btnSet_Click(object sender, EventArgs e)
{
    Hidden1.Value = "Abhijeet Roy";
}

protected void btnGet_Click(object sender, EventArgs e)
{
    lblResult.Text = "Hidden Field Value: " +Hidden1.Value;
}

(c) Cookies

<asp:TextBox ID="txtName" runat="server" />
<asp:Button ID="btnSet" runat="server" Text="Set Cookie" CssClass="btn btn-primary me-2" OnClick="btnSet_Click" />
    <asp:Button ID="btnGet" runat="server" Text="Get Cookie" CssClass="btn btn-success" OnClick="btnGet_Click" />

  <asp:Label ID="lblMessage" runat="server" CssClass="alert alert-info d-block"></asp:Label>

 protected void btnSet_Click(object sender, EventArgs e)
 {
     HttpCookie ck = new HttpCookie("UserName");
     ck.Value = txtName.Text;//Set the value of Cookie
     ck.Expires = DateTime.Now.AddSeconds(10);//Set the expiration time of cookie
     Response.Cookies.Add(ck);

     lblMessage.Text = "Cookie has been set";
 }

 protected void btnGet_Click(object sender, EventArgs e)
 {
     if (Request.Cookies["UserName"] != null)
     {
         string name = Request.Cookies["UserName"].Value;
         lblMessage.Text = "Hello " + name;
     }
     else
     {
         lblMessage.Text = "Cookie has expired";
     }
 }

(d)QueryString 

 <div class="mb-3">
      <asp:TextBox ID="txtName" runat="server" CssClass="form-control" placeholder="Enter Name"></asp:TextBox>
  </div>

  <div class="mb-3">
      <asp:TextBox ID="txtCourse" runat="server" CssClass="form-control" placeholder="Enter Course"></asp:TextBox>
  </div>

  <asp:Button ID="btnSend" runat="server" Text="Send to Page2" CssClass="btn btn-primary" OnClick="btnSend_Click" />

protected void btnSend_Click(object sender, EventArgs e)
{
    string name = txtName.Text;
    string course = txtCourse.Text;

    //redirect with QueryString
    Response.Redirect("Page2.aspx?name="+name+"&course="+course);
}

//Code of Page2.aspx
               <asp:Label ID="lblName" runat="server"></asp:Label>
<br />
<asp:Label ID="lblCourse" runat="server"></asp:Label>


  protected void Page_Load(object sender, EventArgs e)
  {
      if(!IsPostBack)
      {
          string name = Request.QueryString["name"];
          string course = Request.QueryString["course"];
          lblName.Text = name;
          lblCourse.Text = course;
      }
  }





2. Server-Side State Management

(a) Session State : Stores data in server but User-specific.

 <asp:TextBox ID="txtName" runat="server" CssClass="form-control" placeholder="Enter Name"></asp:TextBox>

     <asp:TextBox ID="txtCourse" runat="server" CssClass="form-control" placeholder="Enter Course"></asp:TextBox>

 <asp:Button ID="btnSave" runat="server" Text="Save in Session" CssClass="btn btn-primary" OnClick="btnSave_Click" />



 protected void btnSave_Click(object sender, EventArgs e)
 {
     //Save data in Session
     Session["name"] = txtName.Text;
     Session["course"] = txtCourse.Text;
     Response.Redirect("Page2.aspx");
 }

//Code for Page2.aspx

  <asp:Label ID="lblResult" runat="server"></asp:Label>

protected void Page_Load(object sender, EventArgs e)
{
    if(!IsPostBack)
    {
        if (Session["name"] != null && Session["course"]!= null)
        {
            lblResult.Text = "Welcome " + Session["name"].ToString() + " to " + Session["course"].ToString() + " course.";
        }
        else
        {
            Response.Redirect("StateManagement.aspx");
        }
    }
}

(b) Application State - Application-level data for All Users.

 protected void Application_Start(object sender, EventArgs e)
 {
     Application["TotalUsers"] = 0;
 }

 <div class="mb-3">
      <asp:TextBox ID="txtUser" runat="server" CssClass="form-control" placeholder="Enter Username"></asp:TextBox>
  </div>

  <asp:Button ID="btnLogin" runat="server" Text="Login" CssClass="btn btn-primary" OnClick="btnLogin_Click" />

  <div class="mt-3">
      <asp:Label ID="lblMessage" runat="server" CssClass="alert alert-info d-block"></asp:Label>
  </div>


protected void btnLogin_Click(object sender, EventArgs e)
{
    if(!string.IsNullOrEmpty(txtUser.Text))
    {
        //Lock Application for thread Safety
        Application.Lock();
        Application["TotalUsers"] = (int)Application["TotalUsers"] + 1;
        Application.UnLock();
        lblMessage.Text = "Welcome " + txtUser.Text + "! You are user number " + Application["TotalUsers"].ToString();
    }
}




